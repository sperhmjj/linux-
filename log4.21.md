### 补一个log4.21

==简单添加一下iptables白名单，这个之前做过，但是涉及不深，这次应客户需求，重新学习了一下。==

废话不多说，看操作~

~~~perl
[brudoa@iomapp11 ~]$ sudo su
[root@iomapp11 brudoa]# cat /etc/sysconfig/iptables
# Generated by iptables-save v1.4.7 on Wed Sep 15 18:13:27 2021
*filter
:INPUT ACCEPT [736:131307]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [797:133239]
:ALLOW_ACCESS_8080 - [0:0]
:DENY_ACCESS_8080 - [0:0]
-A INPUT -s 195.2.41.13/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
-A INPUT -s 134.194.14.12/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
-A INPUT -s 195.2.41.12/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
-A INPUT -s 195.2.41.12/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
ACCEPT 
~~~

**查看iptables文件时，记得一定要切换到root用户才可以进行查看，**因为权限设置了只有root用户才可以访问。

因为拿的生产机做笔记，有很多iptables规则，就不全部放出来了，节选几条。

如何添加呢，也是很简单，所以拿出一条写好的白名单。比如（a1）：

~~~perl
-A INPUT -s 134.192.82.39/32 -p tcp -m tcp --dport  8002 -j ACCEPT
~~~

==那我们就照葫芦画猫，看一下我们需要做的规则。==

| 由于需要对RMI漏洞进行修复，请平台组把下面IP和对应的端口，增加白名单设置，白名单的IP均为附件txt里的所有IP <br/>134.192.82.39 8002 <br/>134.192.82.239 33102 <br/>134.192.82.117 6400 <br/>134.192.82.117 6500 <br/>134.192.82.116 6500 |
| :----------------------------------------------------------- |

只需要把需要添加的白名单ip，与iptables例子a1替换一下即可，大致内容如下：

~~~perl
-A INPUT -s 134.192.82.39/32 -p tcp -m tcp --dport  8002 -j ACCEPT
-A INPUT -s 134.192.82.239/32 -p tcp -m tcp --dport  33102  -j ACCEPT
-A INPUT -s 134.192.82.117/32 -p tcp -m tcp --dport  6400 -j ACCEPT
-A INPUT -s 134.192.82.117/32 -p tcp -m tcp --dport  6500 -j ACCEPT
-A INPUT -s 134.192.82.116/32 -p tcp -m tcp --dport  6500  -j ACCEPT
~~~

最后，将以上写好的信息，插入iptables里面就好了，**注意一点，这是白名单（即放行规则），所以一般情况下，都是直接插入白名单的最上方。**

~~~perl
-A INPUT -s 134.192.82.39/32 -p tcp -m tcp --dport  8002 -j ACCEPT
-A INPUT -s 134.192.82.239/32 -p tcp -m tcp --dport  33102  -j ACCEPT
-A INPUT -s 134.192.82.117/32 -p tcp -m tcp --dport  6400 -j ACCEPT
-A INPUT -s 134.192.82.117/32 -p tcp -m tcp --dport  6500 -j ACCEPT
-A INPUT -s 134.192.82.116/32 -p tcp -m tcp --dport  6500  -j ACCEPT
-A INPUT -s 134.194.13.246/32 -p tcp -m tcp --dport 22 -m comment --comment "BaimMing:22" -j ACCEPT 
-A INPUT -s 195.2.41.13/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
-A INPUT -s 134.194.14.12/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
-A INPUT -s 195.2.41.12/32 -p tcp -m multiport --dports 22 -m comment --comment "BaiMingDan:22" -j ACCEPT 
~~~

大概就是这样，最后wq退出，值得一提的是，==添加iptables规则后，需要重启服务才能生效。==